# -*- coding: utf-8 -*-
# -*- mode: org -*-
#+startup: beamer
#+STARTUP: overview
#+STARTUP: indent
#+TAGS: noexport(n)

#+Title: Optimization by modelization and experiment design
#+AUTHOR:      Steven QUINITO MASNADA

#+EPRESENT_FRAME_LEVEL: 2

#+LaTeX_CLASS: beamer
#+LaTeX_CLASS_OPTIONS: [11pt,xcolor=dvipsnames,presentation]
#+OPTIONS:   H:3 num:t toc:nil \n:nil @:t ::t |:t ^:nil -:t f:t *:t <:t

#+LATEX_HEADER: \usedescriptionitemofwidthas{bl}
#+LATEX_HEADER: \usepackage[T1]{fontenc}
#+LATEX_HEADER: \usepackage[utf8]{inputenc}
#+LATEX_HEADER: \usepackage[american]{babel}
#+LATEX_HEADER: \usepackage{ifthen,figlatex,amsmath,amstext,gensymb,amssymb}
#+LATEX_HEADER: \usepackage{boxedminipage,xspace,multicol}
#+LATEX_HEADER: %%%%%%%%% Begin of Beamer Layout %%%%%%%%%%%%%
#+LATEX_HEADER: \ProcessOptionsBeamer
#+latex_header: \mode<beamer>{\usetheme{Madrid}}
#+LATEX_HEADER: \usecolortheme{whale}
#+LATEX_HEADER: \usecolortheme[named=BrickRed]{structure}
# #+LATEX_HEADER: \useinnertheme{rounded}
#+LATEX_HEADER: \useoutertheme{infolines}
#+LATEX_HEADER: \setbeamertemplate{footline}[frame number]
#+LATEX_HEADER: \setbeamertemplate{headline}[default]
#+LATEX_HEADER: \setbeamertemplate{navigation symbols}{}
#+LATEX_HEADER: \defbeamertemplate*{headline}{info theme}{}
#+LATEX_HEADER: \defbeamertemplate*{footline}{info theme}{\leavevmode%
#+LATEX_HEADER:   \hbox{%
#+LATEX_HEADER:     \begin{beamercolorbox}[wd=.5\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
#+LATEX_HEADER:       \usebeamerfont{author in head/foot}\insertshortauthor
#+LATEX_HEADER:     \end{beamercolorbox}%
#+LATEX_HEADER:   \begin{beamercolorbox}[wd=.41\paperwidth,ht=2.25ex,dp=1ex,center]{title in head/foot}%
#+LATEX_HEADER:     \usebeamerfont{title in head/foot}\insertsectionhead
#+LATEX_HEADER:   \end{beamercolorbox}%
#+LATEX_HEADER:   \begin{beamercolorbox}[wd=.09\paperwidth,ht=2.25ex,dp=1ex,right]{section in head/foot}%
#+LATEX_HEADER:     \usebeamerfont{section in head/foot}\insertframenumber{}~/~\inserttotalframenumber\hspace*{2ex} 
#+LATEX_HEADER:   \end{beamercolorbox}
#+LATEX_HEADER:   }\vskip0pt}
#+LATEX_HEADER: \setbeamertemplate{footline}[info theme]
#+LATEX_HEADER: %%%%%%%%% End of Beamer Layout %%%%%%%%%%%%%
#+LATEX_HEADER: \usepackage{verbments}
#+LATEX_HEADER: \usepackage{xcolor}
#+LATEX_HEADER: \usepackage{color}
#+LATEX_HEADER: \usepackage{url} \urlstyle{sf}

#+LATEX_HEADER: \let\alert=\structure % to make sure the org * * works of tools
#+BEAMER_FRAME_LEVEL: 2

#+LATEX_HEADER: \AtBeginSection[]{\begin{frame}<beamer>\frametitle{Topic}\tableofcontents[currentsection]\end{frame}}

#+LATEX_HEADER: %\usepackage{biblatex}
# #+LATEX_HEADER: \bibliography{../../biblio.bib}
# #+LATEX_HEADER: \usepackage{cite}

* Quick reminder
*** Laplacian
- Parameters:
  - x_component_number [1,2,4,8,16]
  - vector_length [1,2,4,8,16]
  - y_component_number [1,2,3,4]
  - temporary_size [2,4]
  - vector_recompute [true,false]
  - load_overlap [true,false]
- 800 combinations
- OpenCL Nvidia implementation

*** Structured problem
- Found what are the parameters that have an impact
- Hierarchy of parameters:
  - x_component_number \downarrow y_component_number \uparrow vector_recompute \uparrow vector_length \downarrow

#+BEGIN_LaTeX
\begin{figure}[tbh]
\centering
\vspace{-1.5mm}
\includegraphics[scale=0.3]{../../img/ordered_1.png}
\end{figure}
#+END_LaTeX
**** Notes :noexport:
- This gives us a region to search and no complicated technics is
  necessary
*** A simple approach : Linear model 
- Global optimum :
- A simple linear regression with a very simple model allowed us to
  find the structure of the search space \to how does it scales?
**** 
    :PROPERTIES:
    :BEAMER_act: <+->
    :END:
\scriptsize
     #+begin_example
     Call:
     lm(formula = time_per_pixel ~ x_component_number + vector_length + 
     y_component_number + vector_recompute, data = df)
     
     Residuals:
       Min         1Q     Median         3Q        Max 
     -3.494e-10 -1.409e-10 -3.041e-11  8.200e-11  1.627e-09 
     
     Coefficients:
                       Estimate Std. Error t value Pr(>|t|)    
     (Intercept)           2.770e-10  2.622e-11  10.567   <2e-16 ***
     x_component_number    1.364e-11  1.552e-12   8.785   <2e-16 ***
     vector_length         2.308e-11  1.552e-12  14.870   <2e-16 ***
     y_component_number   -6.680e-11  7.575e-12  -8.819   <2e-16 ***
     vector_recomputetrue  2.162e-10  1.694e-11  12.763   <2e-16 ***
     ---
     Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
     
     Residual standard error: 2.395e-10 on 795 degrees of freedom
     Multiple R-squared:  0.404,	Adjusted R-squared:  0.401 
     F-statistic: 134.7 on 4 and 795 DF,  p-value: < 2.2e-16
     #+end_example

* Optimizing ~ experimenting
** Enriched the search space
*** Tuning the work size
- Local work size : [32,1], [32,2], [32,4], [32,8], [64,1] ..., [256,1] 
- Max 256 threads per work groups
- 2000 combinations
*** Bigger but not more complicated
- Vector_recompute and load_overlap : true
- Simple linear regression to extract information of the problem
** Extracting the informations without bruteforcing 
*** Genetic Algorithm
- Population size: 20
- Generation limit: 100
#+BEGIN_LaTeX
\begin{figure}[tbh]
\centering
\vspace{-1.5mm}
\includegraphics[scale=0.3]{../../img/20160311/pilipili2/pilipili2_gen_100.png}
\end{figure}
#+END_LaTeX

*** Optimal Design
- 60 / 2000 points
How many points do we need?

*** Genetic Algorithm again

** Giving more clue to the search space
* BOAST modifications
*** Constraints
- Avoid unfeasible points
- Rules = set of boolean expressions
- All rules must be respected
*** Checkpointing
* Conclusion and future work
*** Working with bigger problem
# - Quantification if the warmup problem \to gpu performance mode to start
- Very long \to 1 week for the brute force
*** 1 problem many formulations
- Finer grained formulation vs "naïve"
- How does the search look like?
- D-Optimal still ok?
*** Thinner models
*** Thinner observations
*** How does D-Optimal hold with discrete problems?
